<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: sensu | Timeline]]></title>
  <link href="http://www.ahwkong.com/post/categories/sensu/atom.xml" rel="self"/>
  <link href="http://www.ahwkong.com/"/>
  <updated>2015-03-01T22:13:48+11:00</updated>
  <id>http://www.ahwkong.com/</id>
  <author>
    <name><![CDATA[Anthony Kong]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[how to get sensu hipchat plugin to work]]></title>
    <link href="http://www.ahwkong.com/post/2015/02/28/how-to-get-sensu-hipchat-plugin-to-work/"/>
    <updated>2015-02-28T18:55:00+11:00</updated>
    <id>http://www.ahwkong.com/post/2015/02/28/how-to-get-sensu-hipchat-plugin-to-work</id>
    <content type="html"><![CDATA[<p>I encountered two issues when I want to deploy the hipchat notification handler.</p>

<p>Firstly it throws an exception of &lsquo;Connection refused&rsquo;. But api.hipchat.com is reachable. I have verified by running <code>curl</code> against the v2 api.</p>

<pre><code>    $ cat /tmp/t.json |sudo /opt/sensu/embedded/bin/ruby  /etc/sensu/handlers/notification/hipchat.rb -j /etc/sensu
    /handlers/notification/hipchat.json
    /opt/sensu/embedded/lib/ruby/2.0.0/net/http.rb:878:in `initialize': Connection refused - connect(2) (Errno::ECONNREFUSED)
            from /opt/sensu/embedded/lib/ruby/2.0.0/net/http.rb:878:in `open'
            from /opt/sensu/embedded/lib/ruby/2.0.0/net/http.rb:878:in `block in connect'
            from /opt/sensu/embedded/lib/ruby/2.0.0/timeout.rb:52:in `timeout'
            from /opt/sensu/embedded/lib/ruby/2.0.0/net/http.rb:877:in `connect'
            from /opt/sensu/embedded/lib/ruby/2.0.0/net/http.rb:862:in `do_start'
            from /opt/sensu/embedded/lib/ruby/2.0.0/net/http.rb:851:in `start'
            from /opt/sensu/embedded/lib/ruby/2.0.0/net/http.rb:1367:in `request'
            from /opt/sensu/embedded/lib/ruby/gems/2.0.0/gems/sensu-plugin-1.1.0/lib/sensu-handler.rb:85:in `api_request'
            from /opt/sensu/embedded/lib/ruby/gems/2.0.0/gems/sensu-plugin-1.1.0/lib/sensu-handler.rb:120:in `stash_exists?'
            from /opt/sensu/embedded/lib/ruby/gems/2.0.0/gems/sensu-plugin-1.1.0/lib/sensu-handler.rb:132:in `block (2 levels) in filter_silenced'
            from /opt/sensu/embedded/lib/ruby/2.0.0/timeout.rb:66:in `timeout'
            from /opt/sensu/embedded/lib/ruby/2.0.0/timeout.rb:97:in `timeout'
</code></pre>

<p>It turns out all sensu plugin has a dependeny on the sensu api. I did not start the sensu apu when I tested, and hence the exception.</p>

<p>Then I got a json config file related problem:</p>

<pre><code>    $ cat /tmp/t.json |sudo /opt/sensu/embedded/bin/ruby  /etc/sensu/handlers/notification/hipchat.rb -j /handlers/notification/hipchat.json
    /etc/sensu/handlers/notification/hipchat.rb:44:in `handle': undefined method `[]' for nil:NilClass (NoMethodError)
            from /opt/sensu/embedded/lib/ruby/gems/2.0.0/gems/sensu-plugin-1.1.0/lib/sensu-handler.rb:55:in `block in &lt;class:Handler&gt;'
</code></pre>

<p><code>-j</code> does not work as I expected. The script actually expects the .json configuration in the /opt/sensu/conf.d</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[installing sensu client 0.14 and 0.17.beta1]]></title>
    <link href="http://www.ahwkong.com/post/2015/02/26/installing-sensu-client-0-dot-14-and-0-dot-17-dot-beta1/"/>
    <updated>2015-02-26T15:09:00+11:00</updated>
    <id>http://www.ahwkong.com/post/2015/02/26/installing-sensu-client-0-dot-14-and-0-dot-17-dot-beta1</id>
    <content type="html"><![CDATA[<p>0.17.beta1 does work for me. Fall back to 0.14 but the sensu client window service stopped working too.</p>

<p>I think the windows service needs to be re-registered. Very troublesome</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[sensu plugin problem]]></title>
    <link href="http://www.ahwkong.com/post/2015/02/26/sensu-plugin-problem/"/>
    <updated>2015-02-26T02:12:00+11:00</updated>
    <id>http://www.ahwkong.com/post/2015/02/26/sensu-plugin-problem</id>
    <content type="html"><![CDATA[<p>Encountered problem when installing sensu-plugin</p>

<pre><code>    $ gem install sensu-plugin --no-rdoc --no-ri
    /usr/bin/ruby1.9.1 extconf.rb
    /usr/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require': cannot load such file -- mkmf (LoadError)
            from /usr/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'
            from extconf.rb:1:in `&lt;main&gt;'
</code></pre>

<p>This is the solution: use the ruby runtime embedded in sensu</p>

<pre><code>    $ /opt/sensu/embedded/bin/gem install sensu-plugin
    Fetching: sensu-plugin-1.1.0.gem (100%)
    ERROR:  While executing gem ... (Gem::FilePermissionError)
        You don't have write permissions for the /opt/sensu/embedded/lib/ruby/gems/2.0.0 directory.
    vagrant@default-ubuntu-1404:~$ sudo /opt/sensu/embedded/bin/gem install sensu-plugin
    Successfully installed sensu-plugin-1.1.0
    Parsing documentation for sensu-plugin-1.1.0
    Installing ri documentation for sensu-plugin-1.1.0
    1 gem installed
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cannot find a resource matching ruby_block[sensu_service_trigger]]]></title>
    <link href="http://www.ahwkong.com/post/2015/02/08/cannot-find-a-resource-matching-ruby-block-sensu-service-trigger/"/>
    <updated>2015-02-08T18:26:00+11:00</updated>
    <id>http://www.ahwkong.com/post/2015/02/08/cannot-find-a-resource-matching-ruby-block-sensu-service-trigger</id>
    <content type="html"><![CDATA[<p>This the error message:</p>

<pre><code>    ==&gt; default: ================================================================================
    ==&gt; default: Error executing action `enable` on resource 'sensu_service[sensu-client]'
    ==&gt; default: ================================================================================
    ==&gt; default:
    ==&gt; default: Chef::Exceptions::ResourceNotFound
    ==&gt; default: ----------------------------------
    ==&gt; default: Cannot find a resource matching ruby_block[sensu_service_trigger] (did you define it first?)
    ==&gt; default:
    ==&gt; default: Cookbook Trace:
    ==&gt; default: ---------------
    ==&gt; default: /tmp/vagrant-chef/c66d06dac7e6e1e4d559122d4d1a9f5c/cookbooks/sensu/providers/service.rb:52:in `block in load_current_resource'
</code></pre>

<p>It is because I did not include the <code>sensu::default</code> cookbook.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ochiwa unable to connect to sensu]]></title>
    <link href="http://www.ahwkong.com/post/2015/02/06/ochiwa-unable-to-connect-to-sensu/"/>
    <updated>2015-02-06T05:13:00+11:00</updated>
    <id>http://www.ahwkong.com/post/2015/02/06/ochiwa-unable-to-connect-to-sensu</id>
    <content type="html"><![CDATA[<p>I used chef to install sensu and ochiwa.</p>

<p>In the ocihwa log I see a lot of &lsquo;connection refused&rsquo; error</p>

<pre><code>{"Date":"2015-02-05T09:42:23.516606749Z","Level":"warning","Src":{"Func":"github.com/sensu/uchiwa/uchiwa.Build","Line":49},"Output":"API call to \"http://127.0.0.1:4567/stashes\" returned: Get http://127.0.0.1:4567/stashes: dial tcp 127.0.0.1:4567: connection refused"}
</code></pre>

<p>With help from sensu irc chatroom, I checked</p>

<pre><code>netstat -anp | grep 4567
</code></pre>

<p>There is no process.</p>

<pre><code>service sensu-api status
</code></pre>

<p>The service is stopped.</p>

<p>After starting the service, ochiwa can talk to sensu server now.</p>
]]></content>
  </entry>
  
</feed>
